<?php

$keys = array(
	'j534089ws3j84' => '5', // Arcticblast
	'hse54rgs56ed' => '5', // Aquaaaa
	'gse54rgs84e' => '5', // Tournesol
	'h5s46e5rth' => '+10', // DragonTamerChris
	'7jsw34hs3e4' => '5', // AfroThunderRule
	's3e46s3e4hb64s' => '5', // MissingNO
	's34s34b63es4' => '5', // StevoDuhHero
	'23h6bst3wv4534rf' => '5', // GL1TCH
	'svg346v3gs346' => '5', // SaMaLo
	'78d45bd34gbd' => '5', // The Hall Monitor, Shawn Parks?
	'hws4b6s34vse34' => '5', // Ash Caughtem
	'sv534b3w4nsy5' => '+10', // Arceus Ex Machina
	'5bs35ys3456s' => '5', // Metamaster
	'4s3b4ys34bt3s4' => '5', // WARP
	'sg34sb3e4t34' => '5', // loldongs
	'5bwh35yg34g3' => '5', // ==public
	'h2489yguah3kjr2aj3' => '5', // steamroll
	'sv34s3b4tyb43' => '5', // Dabrikishaw
	's3v4ysb4ey54ny' => '5', // Keai
	'db45yd4bhe4e5' => '5', // FlarePod
	'5bsh45yb4shty' => '5', // Perish Song
	'ha3sw4gt63sh4y' => '5', // JoshBundy
	'af234a34fa34' => '5', // Joeyboy
	'af45af24a2' => '5', // SoulWind
	's34ctseysees' => '5', // Dalek
	'4gvsf4sc454' => '5', // MuriloMarques
	'5gsy54hdu6u' => '5', // Ducinator
	'a2f3523af2' => '5', // H-C
	'naysevtdbsw' => '5', // Texas Cloverleaf
	'y4a3v64ahs4bt' => '5', // weeheehoo
	'av35syvyn5' => '5', // dragonboy52
	'snb5yv4u56nsu' => '5', // romojuice
	'87b67biyudb6t' => '5', // Aqualouis
	'87obt7u6rv56du' => '5', // Neblim
	'7u6tfyi7bnt8' => '5', // Acklow
	'3wf5twd3t4q34t' => '5', // rtc3
	'87tb7niuyuy' => '5', // Trollmonchan
	'4q3t4wy54w' => '5', // Pidge
	'h7e4d5gydrt33' => '5', // Skippy11
	'w7hs35gse5ys54' => '5', // Auraknight
	'syb5yseyse4cy3' => '5', // shnen
	'sy35vse4cy5se4ty' => '5', // Evan Falco
	'sy4s4ts4t34ts' => '5', // daoze555
	's34t5y46ehu54' => '5', // Phi
	'g5yd45vysc45y4' => '5', // Pocket Cucco
	's3g4ts43g6t3s' => '5', // Ice-eyes
	'3b4ya3v4vt3ac4t3' => '5', // Darmanitan14
	'ac34ta3v4t3b4' => '5', // Mostwanted
	'vsye5cyc4ca43' => '5', // Xaqwais
	'a34t3tavt4sv4' => '5', // Zapteryx
	'ys35yv45cy3s4' => '5', // KPrime
	'yvs34yvsey5' => '+10', // Omicron
	'bs345ybs54y' => '5', // SiDoesGood
	's34ybsv4453s4y' => '5', // Fireworks
	'kk34h4532' => '+10', // AccidentalGreed
	't3s4cy5s34t' => '5', // iDerp
	's3y4s4t34' => '5', // Chieliee
	'7a3g46a3f46a23' => '+10', // NixHex
	'59hv83sh49s' => '5', // SkaterTrainer
	'40atj34iuj' => '+10', // Rising_Dusk
	'3gay5w4s5y3' => '5', // tophway
	'43fy453s4y3s4' => '5', // Mysterious Trainer
	'ast34t3a4t34t' => '5', // wotw
	'as34ts34t34' => '5', // PurePwnage
	's43tsy5s34y' => '+10', // macle
	's34y54s34ioi' => '5', // ShinyAzelf
	'w53y453wy5w35w' => '5', // Steven Snype
	'tw34tq3ww4y35w' => '5', // Patronus
	'ywf35y35ywy5' => '5', // New World Order
	'wy435yw4433w54y' => '5', // chase
	'w93g4qg34t35y' => '5', // DFMatt
	'5wy35yw34y34' => '5', // Wynaut?
	'g6w3y5e45vyw' => '5', // Manxer
	'tw343f4tw34t3w34' => '5', // theangryscientist
	'wft34tw34t3w4' => '5', // demasiorus
	't3w4tfq34ft34t' => '5', // tomtom5858
	'q23tq2334tw34' => '9', // jumpluff
	'3wg5yw345tw34' => '3', // drevan
	'w3t5w34ytw34tw3' => '9', // Delta2777
	'wt34wvt34w34t3w5' => '9', // Honko
	'8o7btinoiuh' => '4', // King N
	'87bonuihuhu' => '5', // Iceydude168
	'bi87f6856i7' => '5', // Mewcario2546
	'w983s4ht3kl' => '5', // Bromishi
	'4t34ya3t434t' => '5', // Breludicolo
	'aefawegary34a' => '5', // Karpman
	'y3s4ys34y34y' => '5', // YoshiLover
	'ba35y3462363' => '5', // Maniak
	'yn985o3u4t3a44' => '9', // ethereal
	'4ty59uhisoijeo' => '+10', // Surgo
	'a34tcc34t34t' => '5', // Woodchuck
	'f34tw34yc34344t' => '5', // thepkmnmaster
	'va4yw34gw3s5fy3' => '5', // Pwnemon
	't34tq24trq23r2q' => '5', // Neb555
	'tac4t3c4tc34t' => '5', // YAYtears
	'ah4ya34bay34va34' => '5', // RitterCat
	'a43vta34vcta34cta3' => '5', // MaestroXXVI
	'av4ta3v4tca34tva34' => '5', // doominic77
	'sb4y3v4t34c343' => '5', // pokemon0078
	'a4vtsnby34by3sb4' => '5', // Engineer Pikachu
	'sn45ybs5evyse5y' => '+10', // tennisace
	'vdrtyv5syv4s5yv' => '5', // SteelEdges
	'usj45sbe54b54' => '9', // bojangles
	'34bsy5ysbrtye' => '5', // mcculla28
	'7bt7niguygnu7' => '5', // Kiorein
	'875bee5edn7ftfu' => '5', // dkurt89
	'qb34tvw3ct43w34' => '5', // Darkamber8828
	'a34tgv234c24tc2' => '10', // Calm Pokemaster, jayjinde
	'a34t3c4twt5ty34w' => '+10', // kyledove
	'bysy45vy3c4y3' => '+10', // John
	'y3b5yyyyvs4v3es' => '9', // Theorymon + McMeghan
	'y4ns45byvsu45' => '9', // aldaron
	'5un46hbsv45y45v45' => '+10', // iss
	's4j56unb4v5s45c4y' => '9', // Wild Eep
	's45y45y45ws345' => '5', // Thepain
	's45by455ysc5cy45' => '5', // Birkal
	's3h5yv4vs5ys35yc4' => '25', // hotdogturtle
	'sye5yb4s5ys45y45' => '5', // Kingclown50
	'sje5nuby45ub4s5v4' => '5', // Lickmybergers
	'b5s45vy4s5cs54' => '5', // Lesser Smaug
	'bu56s345vy35cy34w' => '5', // Limi
	'65345yvurjnsfvcs' => '+10', // ifm
	'4nu6bs4v5y4s45ys45' => '5', // ToF
	'yb54sv4y5s45y45' => '5', // Weebos
	'bo87n87ym8979huyi' => '5', // itsme
	'796rbn6fiuyghuyig' => '5', // Diploman
	'875brfn6tuyguiyguy' => '5', // Balchmorn
	'uw6fj5e6e4y98m98m' => '5', // Charmander
	'876tkguyihuhouyg6r' => '+10', // Lamppost
	'86bd7nf8mg7yighuygmt' => '9', // Hugendugen
	'57dbnf68mg7nf76f6mtft' => '5', // comatt
	'x64eb5dn75rf6mg7' => '5', // Guyguypants
	'n987whtuhi3galt' => '5', // kmuffinman
	'94ntay3i48yuthkia' => '5', // huggye
	'7s346ys4y3s4tfs34' => '5', // Metric
	'897tb67dntuyiuguyhu' => '5', // Improbable
	'awv4taw4etcaw4c3' => '5', // kwando1313
	'hbas4yvs4tc3s434y' => '5', // Tiffanyy
	'4s3h54ys4ye5ys5y4s5' => '5', // SuperPokenerd
	'54se5ybse4geysegs' => '+10', // Hob
	'74hf9283h4f234f2' => '5', // Ace Emerald
	'f23h498j203034' => '5', // verbatim
	'983j443j4oifji234' => '5', // Amarillo
	'4y234u89f234234' => '5', // HoiPolloi
	'fh49832joj2i3ji23' => '5', // FinnTheWastelander
	'ag4v6aw3c53c2535' => '+10', // Violatic
	'ahg43a34a3f5a23d2a3' => '9', // Stormclouds
	'a35b6ay63s4vy4' => '+10', // whatevs
	'va3v5a3c5ag5b3' => '+10', // MS
	'7b4s43v6s4v436s4' => '10', // public #2
	'avg23v5ta3c5a23ca23' => '10', // stone cold
	'6sv34sv34swh36es' => '10', // Amarillo
	'gs46e5r4g65se4r6g5e4' => '5', // Rjwegz
	'h4se6t54jd6fgh54jf6g5h' => '+10', // Zurich
	'kf45g6h564jr6dt546j' => '5', // Wiz
	'jd64j6rt4565dhr456t' => '5', // Gerard
	'd4r6t5h4dr65t4hd6r' => '5', // zek4040
	'k47s96er4thy654sdr' => '5', // KorKonT
	'hja56es4r5h4sd6fgj' => '5', // Salemsectra
	'hjdr46t54hd65r46t' => '5', // lol6789
	'k4d65r4t6hs54ere' => '5', // Thorns
	'h4ser65th65se4r5h4s' => '5', // ungulateman
	'j46dr5t4hj6s54er6g5s4er' => '5', // Yllnath
	'3kjs45ude4yhbs34' => '5', // Purple Cant
	'aj3y5hse5yse4gys' => '5', // Jealous
	'kmus45dhur5njd4r' => '5', // Fishkiller nomore
	'umkdr56ud45hud4r5' => '5', // zombachu
	'u6kd45s34j75d' => '5', // Deity
	'7d4k568dr454' => '+10', // Jibaku
	't4s73a4s634b3' => '5', // Kingtrace
	'jg10294u89jflsa' => '5', // Soarin
	'les45jsd45jn4w' => '5', // Sparky
	'jw457eh457je45' => '+10', // Aerrow
	'e4jm57he457ke45' => '+10', // LonelyNess
	'7k54r7j5685rmk68' => '+10', // ginganinja
	'8kr567568r568jrt' => '5', // JRank
	'4g9ha834gkjalw4th2a' => '+10', // Ditto
	'9gh8a3w94iotajw4h' => '+Obvious', // Obvious
	't043t23t43w5yl3jo2' => '10', // Macchiateau
	'vyb9w3u4ntca23t24y' => '+10', // DHR
	'yhv2934iocsotj35c3' => '+10', // Red Alert
	'yvjn3w402348ut938420' => '25', // Moonlapse
	'8hv59yw3jisu4thjk3s' => '5', // PBOB
	'9tg83hw49tjiw34jt3' => '5', // Zarox
	'23y54he4jw354yw34' => '5', // DGBsLeaderKamina
	'ihj045w98j393tg4w34' => '5', // Marre
	'yj3984jt9w34jito3' => '+10', // Serei
	'yi93iwj9t3ui4jiow34t3' => '5', // Tpyo
	'98wh39ur3igthu3' => '5', // elipSEverity
	'8249tghusiwkjfowiofja' => '10', // Drielme
	'b783qh4tyuhw4skuth43' => '5', // Okuu
	'yn8vw37y47tw3uy4tg3' => '+10', // Kyoukusho
	'hj3895jswhy34tw34h6w3' => '5', // Floating
	'7jnw3bg6e7v57e4fv5345' => '5', // gameshrk90
	'e7hd357nur56nuje46be745' => '5', // aegyo
	'y43bn7syv34yta3v4yta3' => '5', // LibraSnakes13
	'yab4vta4caw4vt34a' => '5', // LightBlue
	'ynab34ta34tca3w4a2' => '5', // unreconstructed
	'sc4t34tby3v53c3s4t3' => '5', // 494
	'b3s4ys34ct34t23t23' => '5', // Rowchee
	'hj6e4yt45etsgsj56hy4e5' => '5', // DTC's
	'lkjuydrtghndry' => '5', // DTC's
	'4hw6juye46sjsu45y4' => '5', // DTC's
	'7h5tw34twh45wjte45yw45' => '5', // Pharen
	'nue45estyhw45yw45wy' => '10', // techniloom
	'sigjeorij34oigoa3' => '10', // hawnt
	'nijw3oi4jcqo3ij4xtq2' => '5', // Gary
	'nuwijb394icjtqi924jxt' => '5', // Leader Jasmine
	'9g8i3o2jfi23ij4oif' => '5', // 
	'fu0923ojfwiij32oi3ji3' => 'xax', // ethereal
	'hf923huikfhi3u4f' => '+10', // Deck_Knight
	'gjh839j4ji3u4jt324g' => '5', // phoopes
	'jtn459w82u948r2q3' => '5', // bashy
	'hn59j34iut3jw4t2' => '5', // Coyote-Stark
	'ifwjoaijegoiawjef' => '5', // PUB
	'hj9358gaoiwjiofwaerwae' => '5', // rku
	'gh3578wh34iufgkj3i4t' => '5', // srk1214
	'hg28948thgiuwkh54gt3' => '1', // outlaw4
	'g3ijh982j3ir2q3' => '5', // Hello2
	'h4829a23rjk23jr3' => '1', // 
	'j4w6su5eytghs34y53hwy5t5@$' => '50', // giveaway
	'h8f72h38uhkf234f343' => '5', // bashybushman
	'3gh984ahwit32hoir3j2' => '5', // xpsp2
	'ajwoeifja2839toj2ijar' => '5', // iRawrDragonite
	'8934jg2iuh4gk2j3lk2j3r' => '5', // prankster
	'28394thgu4ijhkjnk2t3' => '5', // sean
	'h27398guh4iukwjakjwnf' => '5', // welch
	'8q9c3hugjo2awejl23' => '+5', // stoopidphukr
	'93823wt940gc8joal23jxt' => '+5', // Kalashnikov
	'jaoi3928gj9aoi32lj23' => '+10', // Noire
	'289thag3ikwejtl2kaj23' => '1', // some guy
	'2t492oajl3jt23t2q2tq' => '5', // stoopidphukr again
	'j938w4tkj3lyj4oi3josy4' => '5', // brenner
	'y9034w934uyjwi3k4tw34t234' => '+10', // Marty
	'j7qn3ub4sv3y45c3s4ct3w4' => '5', // supercoolsnorlax
	'yj09384utoiwj34iotj3wo4iot34' => '5', // elemental
);

if (!$_REQUEST['key']) die('<p>Enter a beta key:</p><form><p><input type="text" name="key" /><button type="submit">OK</button></p></form>');

if (!$keys[$_REQUEST['key']]) die('<p>Your beta key is invalid</p>');

$key = $_REQUEST['key'];
$user = $keys[$_REQUEST['key']];

$voice = false;
if (substr($user,0,1) === '+')
{
	$voice = true;
	$user = substr($user,1);
}

$maxusecount = 1;

if (ctype_digit($user))
{
	$maxusecount = intval($user);
	$user = '';
}

include 'lib/ntbb-session.lib.php';

$usecount = $users->keyCount($key);

if ($usecount >= $maxusecount) die('This key has already been used its maximum number of times ('.$usecount.' times).');
if ($usecount > 0) $voice = false;

$pass = @$_POST['pass'];
$pass2 = @$_POST['pass2'];

if ($pass && $pass === $pass2)
{
	if (!$user) $user = $_REQUEST['user'];
	if (!$user) die('Username not specified. Click Back and try again.');
	if ($users->addUser(array('username'=>$user, 'signupkey'=>$key), $pass))
	{
		if ($voice)
		{
			if ($users->modifyUser($curuser, array('group' => 3)))
			{
				die('User created and voiced. <a href="/">You may now proceed to PS.</a>');
			}
			else
			{
				die('User created, but voicing FAILED: '.$error);
			}
		}
		die('User created. <a href="/">You may now proceed to PS.</a>');
	}
	else
	{
		die('There\'s already a user with this name (you probably already created an account).');
	}
}
else if ($pass || $pass2)
{
	die('Passwords don\'t match. Click Back and try again.');
}
?>
<form method="post" action="/sekritmkuser.php?key=<?php echo $key ?>">
	<p>Beta key: <?php echo $key ?></p>
<?php if ($voice) { ?>
	<p>VOICE - the first use of this beta key will automatically voice your account after creation. <?php if ($maxusecount>1) { ?> Subsequent usages (i.e. when your friends register) will create regular (unvoiced) accounts.<?php } ?></p>
<?php } ?>
	<p>This key can be used <strong style="font-size:24pt"><?php echo $maxusecount - $usecount; ?></strong> more time(s)</p>
<?php if ($maxusecount - $usecount > 1) { ?>
	<p><strong>Give this link to your friends.</strong> This key can be used <?php echo $maxusecount; ?> times total: <strong>for you and <?php echo $maxusecount-1; ?> friends</strong>.</p>
<?php } ?>
	<p>Username: <?php echo $user?$user:'<input type="text" name="user" />' ?></p>
	<p>Password: <input type="password" name="pass" /></p>
	<p>Password (confirm): <input type="password" name="pass2" /></p>
	<p><button type="submit">Register an account</button></p>
</form>
